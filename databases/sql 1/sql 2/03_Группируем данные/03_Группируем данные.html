<!DOCTYPE html>
<html lang="ru" data-react-helmet="lang"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>Яндекс.Практикум</title>
      <link data-react-helmet="true" href="./03_Группируем данные_files/suisse.css" rel="preload" as="style"><link data-react-helmet="true" href="./03_Группируем данные_files/ys.css" rel="preload" as="style"><link data-react-helmet="true" href="./03_Группируем данные_files/spectral.css" rel="preload" as="style"><link data-react-helmet="true" href="./03_Группируем данные_files/suisse.css" rel="stylesheet"><link data-react-helmet="true" href="./03_Группируем данные_files/ys.css" rel="stylesheet"><link data-react-helmet="true" href="./03_Группируем данные_files/spectral.css" rel="stylesheet"><link data-react-helmet="true" href="https://yastatic.net/q/praktikum/v0.132.8-1591111175/static/favicon.png" rel="shortcut icon" type="image/x-icon"><link data-react-helmet="true" rel="apple-touch-icon" sizes="180x180" href="https://yastatic.net/q/praktikum/v0.132.8-1591111175/static/apple-touch-icon.png"><link data-react-helmet="true" rel="icon" type="image/png" sizes="32x32" href="https://yastatic.net/q/praktikum/v0.132.8-1591111175/static/favicon-32x32.png"><link data-react-helmet="true" rel="icon" type="image/png" sizes="16x16" href="https://yastatic.net/q/praktikum/v0.132.8-1591111175/static/favicon-16x16.png"><link data-react-helmet="true" rel="manifest" href="https://yastatic.net/q/praktikum/v0.132.8-1591111175/static/site.webmanifest"><link data-react-helmet="true" rel="mask-icon" href="https://yastatic.net/q/praktikum/v0.132.8-1591111175/static/safari-pinned-tab.svg" color="#000000">

        <link rel="stylesheet" href="./03_Группируем данные_files/vendor.build.css">
        <link rel="stylesheet" href="./03_Группируем данные_files/common.build.css">
        <link rel="stylesheet" href="./03_Группируем данные_files/proficiency.build.css">
  <section class="lesson proficiency-page__content"><div class="markdown markdown_size_normal markdown_type_theory theory-viewer__markdown theory-viewer__markdown_flexible big-theory lesson__theory lesson__markdown"><h1>Группируем данные</h1><div class="paragraph">Представим, что есть такая таблица:</div><div class="table"><div class="scrollable-default scrollable scrollable_theme_light table__wrapper table__wrapper_scrollable-x table__wrapper_scrollable-y"><div></div><div class="scrollable__content-wrapper"><div class="scrollable__content-container" style="--scroll-bar-width:17px; --scroll-bar-height:17px;"><div class="scrollable__content"><table cellpadding="0" cellspacing="0"><thead><tr><th scope="col">id</th><th scope="col">Name</th><th scope="col">genre</th><th scope="col">author</th><th scope="col">date_pub</th><th scope="col">pages</th><th scope="col">price</th><th scope="col">rating</th></tr></thead><tbody><tr><td>1</td><td>Капитанская дочка</td><td>5</td><td>Александр Пушкин</td><td>1836-01-01</td><td>130</td><td>150</td><td>4.7</td></tr><tr><td>2</td><td>Отцы и дети</td><td>1</td><td>Иван Тургенев</td><td>1861-01-01</td><td>240</td><td>207</td><td>4.7</td></tr><tr><td>3</td><td>Вишнёвый сад</td><td>7</td><td>Антон Чехов</td><td>1903-01-01</td><td>60</td><td>138</td><td>4.4</td></tr><tr><td>4</td><td>Война и мир</td><td>1</td><td>Лев Толстой</td><td>1869-01-01</td><td>1274</td><td></td></tr><tr><td>5</td><td>Анна Каренина</td><td>1</td><td>Лев    Толстой</td><td>1878-01-01</td><td>1000</td><td>126</td><td>4.6</td></tr><tr><td>6</td><td>Цветы для Элджернона</td><td>4</td><td>Дэниел    Киз</td><td>1959-01-01</td><td>250</td><td>280</td><td>4.7</td></tr><tr><td>7</td><td>Похороните меня за плинтусом...</td><td>5</td><td>Павел    Санаев</td><td>1994-01-01</td><td>184</td><td>198</td><td>4.1</td></tr><tr><td>8</td><td>Зелёная миля</td><td>9</td><td>Стивен    Кинг</td><td>1996-01-01</td><td>420</td><td>190</td><td>4.8</td></tr><tr><td>9</td><td>Унесённые ветром</td><td>1</td><td>Маргарет    Митчелл</td><td>1936-01-01</td><td>624</td><td>358</td><td></td></tr><tr><td>10</td><td>Три товарища</td><td>1</td><td>Эрих Мария Ремарк</td><td>1929-01-01</td><td>470</td><td>196</td><td>4.7</td></tr><tr><td>11</td><td>На Западном фронте без перемен</td><td>4</td><td>Эрих Мария Ремарк</td><td>1945-01-01</td><td>200</td><td>273</td><td>4.6</td></tr><tr><td>12</td><td>Триумфальная арка</td><td>1</td><td>Эрих Мария    Ремарк</td><td>1956-01-01</td><td>520</td><td>220</td><td>4.7</td></tr><tr><td>13</td><td>Чёрный обелиск</td><td>1</td><td>Эрих Мария Ремарк</td><td>1961-01-01</td><td>480</td><td>420</td><td>4.6</td></tr><tr><td>14</td><td>Ночь в Лиссабоне</td><td>1</td><td>Эрих Мария Ремарк</td><td>1959-01-01</td><td>250</td><td>187</td><td>4.7</td></tr><tr><td>15</td><td>Жизнь взаймы</td><td>1</td><td>Эрих Мария    Ремарк</td><td>1927-01-01</td><td>240</td><td>240</td><td>4.6</td></tr><tr><td>16</td><td>Станция на горизонте</td><td>1</td><td>Эрих Мария Ремарк</td><td>1830-01-01</td><td>210</td><td></td><td>4.1</td></tr><tr><td>17</td><td>Евгений Онегин</td><td>1</td><td>Александр    Пушкин</td><td>1820-01-01</td><td>736</td><td>330</td><td>4.7</td></tr></tbody></table><div></div></div></div></div><section class="scrollbar-default scrollbar scrollbar_vertical scrollbar_hoverable scrollbar_compact scrollable__scrollbar scrollable__scrollbar_type_vertical" style="--scrollbar-offset-size:333px; --scrollbar-control-size:87.3688px; --scrollbar-control-container-size:100%; --scrollbar-scale:0.96997; --scrollbar-control-offset:0;"><div class="scrollbar__control-container"><div class="scrollbar__control"><div class="scrollbar__control-line"></div></div></div></section><section class="scrollbar-default scrollbar scrollbar_horizontal scrollbar_hoverable scrollbar_compact scrollable__scrollbar scrollable__scrollbar_type_horizontal" style="--scrollbar-offset-size:697px; --scrollbar-control-size:647.992px; --scrollbar-control-container-size:100%; --scrollbar-scale:0.985653; --scrollbar-control-offset:0;"><div class="scrollbar__control-container"><div class="scrollbar__control"><div class="scrollbar__control-line"></div></div></div></section></div></div><div class="paragraph">Так подсчитали количество книг, написанных Ремарком:</div><pre class="sql code-block code-block_theme_light"><div class="code-block__tools"><span class="code-block__clipboard">Скопировать код</span><span class="code-block__lang">SQL</span></div><code class="code-block__code sql hljs"><span class="hljs-keyword">SELECT</span>
    <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">name</span>) <span class="hljs-keyword">AS</span> cnt
<span class="hljs-keyword">FROM</span>
    books
<span class="hljs-keyword">WHERE</span>
    author = <span class="hljs-string">'Эрих Мария Ремарк'</span>;</code></pre><pre class="sql code-block code-block_theme_light"><div class="code-block__tools"><span class="code-block__clipboard">Скопировать код</span><span class="code-block__lang">SQL</span></div><code class="code-block__code sql hljs">7</code></pre><div class="paragraph">Как найти число книг каждого автора? Не писать же несколько запросов! Хорошо бы автоматически перебирать авторов, и сразу же считать количество их произведений. Для этого есть группировка. </div><div class="paragraph">Команду <strong>GROUP BY</strong> (англ. «группировать&nbsp;по») применяют, когда данные нужно разделить на группы по значениям полей. </div><div class="paragraph">Пример формата запроса с агрегирующей функцией и группировкой: </div><pre class="sql code-block code-block_theme_light"><div class="code-block__tools"><span class="code-block__clipboard">Скопировать код</span><span class="code-block__lang">SQL</span></div><code class="code-block__code sql hljs"> <span class="hljs-keyword">SELECT</span> 
    поле_1, 
    поле_2, 
    ..., 
    поле_n, 
    АГРЕГИРУЮЩАЯ_ФУНКЦИЯ(поле) <span class="hljs-keyword">AS</span> here_you_are
<span class="hljs-keyword">FROM</span>
    таблица
<span class="hljs-keyword">WHERE</span> <span class="hljs-comment">-- если необходимо</span>
    условие 
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 
    поле_1, 
    поле_2, 
    ..., 
    поле_n;</code></pre><div class="paragraph">После команды <strong>GROUP BY</strong> перечисляют все поля из блока SELECT. Саму агрегирующую функцию включать в блок GROUP BY не нужно — с ней запрос не выполнится. </div><div class="paragraph">Вернёмся к примеру. В нашем случае агрегирующая функция — COUNT(). Команда GROUP BY поможет найти количество строк в разрезе авторов:</div><pre class="sql code-block code-block_theme_light"><div class="code-block__tools"><span class="code-block__clipboard">Скопировать код</span><span class="code-block__lang">SQL</span></div><code class="code-block__code sql hljs"><span class="hljs-keyword">SELECT</span> 
    author, 
    <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">name</span>) <span class="hljs-keyword">AS</span> cnt
<span class="hljs-keyword">FROM</span>
    books
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 
    author;</code></pre><div class="table"><div class="scrollable-default scrollable scrollable_theme_light table__wrapper table__wrapper_scrollable-y"><div></div><div class="scrollable__content-wrapper"><div class="scrollable__content-container" style="--scroll-bar-width:17px; --scroll-bar-height:17px;"><div class="scrollable__content"><table cellpadding="0" cellspacing="0"><thead><tr><th scope="col">author</th><th scope="col">cnt</th></tr></thead><tbody><tr><td>Александр Пушкин</td><td>2</td></tr><tr><td>Антон Чехов</td><td>1</td></tr><tr><td>Дэниел Киз</td><td>1</td></tr><tr><td>Иван Тургенев</td><td>1</td></tr><tr><td>Лев Толстой</td><td>2</td></tr><tr><td>Маргарет Митчелл</td><td>1</td></tr><tr><td>Павел Санаев</td><td>1</td></tr><tr><td>Стивен Кинг</td><td>1</td></tr><tr><td>Эрих Мария Ремарк</td><td>7</td></tr></tbody></table><div></div></div></div></div><section class="scrollbar-default scrollbar scrollbar_vertical scrollbar_hoverable scrollable__scrollbar scrollable__scrollbar_type_vertical" style="--scrollbar-offset-size:333px; --scrollbar-control-size:287.069px; --scrollbar-control-container-size:100%; --scrollbar-scale:1; --scrollbar-control-offset:0;"><div class="scrollbar__control-container"><div class="scrollbar__control"><div class="scrollbar__control-line"></div></div></div></section><section class="scrollbar-default scrollbar scrollbar_horizontal scrollbar_hidden scrollbar_hoverable scrollable__scrollbar scrollable__scrollbar_type_horizontal" style="--scrollbar-offset-size:698px; --scrollbar-control-size:698px; --scrollbar-control-container-size:100%; --scrollbar-scale:1; --scrollbar-control-offset:0;" size="1"><div class="scrollbar__control-container"><div class="scrollbar__control"><div class="scrollbar__control-line"></div></div></div></section></div></div><div class="paragraph">Теперь мы знаем, сколько книг написал каждый из авторов таблицы. </div><div class="paragraph">Подсчитаем количество книг в разрезе авторов и рейтинга: </div><pre class="sql code-block code-block_theme_light"><div class="code-block__tools"><span class="code-block__clipboard">Скопировать код</span><span class="code-block__lang">SQL</span></div><code class="code-block__code sql hljs"><span class="hljs-keyword">SELECT</span> 
    author, 
    rating, 
    <span class="hljs-keyword">COUNT</span>(<span class="hljs-keyword">name</span>) <span class="hljs-keyword">AS</span> cnt
<span class="hljs-keyword">FROM</span>
    books
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 
    author, 
    rating;</code></pre><div class="table"><div class="scrollable-default scrollable scrollable_theme_light table__wrapper table__wrapper_scrollable-y"><div></div><div class="scrollable__content-wrapper"><div class="scrollable__content-container" style="--scroll-bar-width:17px; --scroll-bar-height:17px;"><div class="scrollable__content"><table cellpadding="0" cellspacing="0"><thead><tr><th scope="col">author</th><th scope="col">rating</th><th scope="col">cnt</th></tr></thead><tbody><tr><td>Лев Толстой</td><td></td><td>1</td></tr><tr><td>Маргарет Митчелл</td><td></td><td>1</td></tr><tr><td>Павел Санаев</td><td>4.1</td><td>1</td></tr><tr><td>Эрих Мария Ремарк</td><td>4.1</td><td>1</td></tr><tr><td>Антон Чехов</td><td>4.4</td><td>1</td></tr><tr><td>Лев Толстой</td><td>4.6</td><td>1</td></tr><tr><td>Эрих Мария Ремарк</td><td>4.6</td><td>3</td></tr><tr><td>Александр Пушкин</td><td>4.7</td><td>2</td></tr><tr><td>Дэниел Киз</td><td>4.7</td><td>2</td></tr><tr><td>Иван Тургенев</td><td>4.7</td><td>1</td></tr><tr><td>Эрих Мария Ремарк</td><td>4.7</td><td>3</td></tr><tr><td>Стивен Кинг</td><td>4.8</td><td>1</td></tr></tbody></table><div></div></div></div></div><section class="scrollbar-default scrollbar scrollbar_vertical scrollbar_hoverable scrollable__scrollbar scrollable__scrollbar_type_vertical" style="--scrollbar-offset-size:333px; --scrollbar-control-size:228.978px; --scrollbar-control-container-size:100%; --scrollbar-scale:1; --scrollbar-control-offset:0;"><div class="scrollbar__control-container"><div class="scrollbar__control"><div class="scrollbar__control-line"></div></div></div></section><section class="scrollbar-default scrollbar scrollbar_horizontal scrollbar_hidden scrollbar_hoverable scrollable__scrollbar scrollable__scrollbar_type_horizontal" style="--scrollbar-offset-size:698px; --scrollbar-control-size:698px; --scrollbar-control-container-size:100%; --scrollbar-scale:1; --scrollbar-control-offset:0;" size="1"><div class="scrollbar__control-container"><div class="scrollbar__control"><div class="scrollbar__control-line"></div></div></div></section></div></div><div class="paragraph">Эта конструкция вернула таблицу с количеством книг и их рейтингом определённого автора. Например, Эрих Мария Ремарк написал три книги с рейтингом 4.6, одну — с оценкой 4.1 и три с 4.7. А у Льва Толстого одно произведение с 4.6 баллами рейтинга и одно — вовсе без оценки. </div><div class="paragraph">Конструкция GROUP BY работает для всех агрегирующих функций: COUNT(), AVG(), SUM(), MAX(), MIN(). Можно вызывать несколько функций сразу. Например, для каждого автора найдём среднее количество страниц в его произведениях и максимальное количество страниц:</div><pre class="sql code-block code-block_theme_light"><div class="code-block__tools"><span class="code-block__clipboard">Скопировать код</span><span class="code-block__lang">SQL</span></div><code class="code-block__code sql hljs"><span class="hljs-keyword">SELECT</span> 
    author, 
    <span class="hljs-keyword">AVG</span>(pages) <span class="hljs-keyword">AS</span> avg_pages,
    <span class="hljs-keyword">MAX</span>(pages) <span class="hljs-keyword">AS</span> max_pages
<span class="hljs-keyword">FROM</span>
    books
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 
    author;</code></pre><div class="table"><div class="scrollable-default scrollable scrollable_theme_light table__wrapper table__wrapper_scrollable-y"><div></div><div class="scrollable__content-wrapper"><div class="scrollable__content-container" style="--scroll-bar-width:17px; --scroll-bar-height:17px;"><div class="scrollable__content"><table cellpadding="0" cellspacing="0"><thead><tr><th scope="col">author</th><th scope="col">avg_pages</th><th scope="col">max_pages</th></tr></thead><tbody><tr><td>Александр Пушкин</td><td>433</td><td>736</td></tr><tr><td>Антон Чехов</td><td>60</td><td>60</td></tr><tr><td>Дэниел Киз</td><td>250</td><td>250</td></tr><tr><td>Иван Тургенев</td><td>240</td><td>240</td></tr><tr><td>Лев Толстой</td><td>1137</td><td>1274</td></tr><tr><td>Маргарет Митчелл</td><td>624</td><td>624</td></tr><tr><td>Павел Санаев</td><td>184</td><td>184</td></tr><tr><td>Стивен Кинг</td><td>420</td><td>420</td></tr><tr><td>Эрих Мария Ремарк</td><td>338,571428571429</td><td>520</td></tr></tbody></table><div></div></div></div></div><section class="scrollbar-default scrollbar scrollbar_vertical scrollbar_hoverable scrollable__scrollbar scrollable__scrollbar_type_vertical" style="--scrollbar-offset-size:333px; --scrollbar-control-size:287.069px; --scrollbar-control-container-size:100%; --scrollbar-scale:1; --scrollbar-control-offset:0;"><div class="scrollbar__control-container"><div class="scrollbar__control"><div class="scrollbar__control-line"></div></div></div></section><section class="scrollbar-default scrollbar scrollbar_horizontal scrollbar_hidden scrollbar_hoverable scrollable__scrollbar scrollable__scrollbar_type_horizontal" style="--scrollbar-offset-size:698px; --scrollbar-control-size:698px; --scrollbar-control-container-size:100%; --scrollbar-scale:1; --scrollbar-control-offset:0;" size="1"><div class="scrollbar__control-container"><div class="scrollbar__control"><div class="scrollbar__control-line"></div></div></div></section></div></div></div><div class="lesson__markdown-btn"><button class="button button_size_m button_type_default button_theme_light button_view_normal button_has-hover-color lesson__button" type="button" style="--button-hover-color:var(--profession-color, $pureBlue);"><span class="button__text"><span>Перейти к заданию</span></span></button></div></section></div>
</body></html>